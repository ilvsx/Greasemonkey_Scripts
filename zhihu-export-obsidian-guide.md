# 知乎回答同步到 Obsidian 使用指南

## 功能简介

这是一个油猴脚本,可以将知乎的回答和文章导出到 Obsidian,支持:

- 批量选择多个回答一次性导出到同一文件
- 通过 Obsidian Local REST API 直接写入笔记
- 自动下载并保存图片到 Obsidian 附件目录
- HTML 自动转换为 Markdown 格式
- 使用 Obsidian Callout 格式美化显示
- 自动生成 YAML frontmatter 元数据
- 支持追加模式,可持续补充回答到已有文件

---

## 安装前提

### 1. 安装油猴扩展

在浏览器中安装以下任一扩展:
- [Tampermonkey](https://www.tampermonkey.net/)(推荐)
- [Violentmonkey](https://violentmonkey.github.io/)
- [Greasemonkey](https://www.greasespot.net/)(仅 Firefox)

### 2. 安装 Obsidian Local REST API 插件

1. 打开 Obsidian → 设置 → 第三方插件
2. 关闭"安全模式"
3. 点击"浏览",搜索 `Local REST API`
4. 安装并启用该插件
5. 在插件设置中:
   - 记录 **API Key**(必需)
   - 默认端口为 `27123`

> 插件地址: https://github.com/coddingtonbear/obsidian-local-rest-api

### 3. 安装本脚本

将 `zhihu-export-obsidian.js` 导入到油猴扩展中。

---

## 配置说明

访问任意知乎问题页面或专栏文章,右下角会出现一个紫色的 📝 浮动按钮。

### Obsidian 连接设置

| 配置项 | 说明 | 默认值 |
|--------|------|--------|
| Obsidian 连接地址 | Obsidian REST API 地址 | `http://localhost:27123` |
| API Key | 在 Obsidian 插件设置中获取 | (必填) |
| 存储路径 | 笔记保存的 Vault 内目录 | `知乎收藏` |
| 图片文件夹 | 图片文件保存目录 | `attachments` |

### 配置步骤

1. 点击右下角的 📝 按钮打开面板
2. 点击 "⚙️ 设置" 展开配置选项
3. 填写 Obsidian 连接地址和 API Key
4. 点击 "测试连接" 确认配置正确
5. 根据需要修改存储路径和图片文件夹
6. 配置会自动保存,无需手动保存

---

## 使用方法

### 基本流程

1. 打开要导出的知乎问题页面(如 `https://www.zhihu.com/question/123456`)
2. 点击右下角的 📝 浮动按钮
3. 点击 "抓取" 按钮
4. 在弹出的对话框中选择要导出的回答(可多选)
5. 点击 "确认抓取" 开始导出
6. 等待导出完成,笔记将自动保存到 Obsidian

### 支持的页面类型

| 页面类型 | URL 格式 | 说明 |
|---------|---------|------|
| 知乎问题 | `https://www.zhihu.com/question/*` | 支持批量选择多个回答 |
| 知乎专栏 | `https://zhuanlan.zhihu.com/p/*` | 导出专栏文章 |

### 批量选择功能

- **单选**: 点击回答前的复选框
- **全选**: 点击对话框底部的 "全选" 复选框
- **已选计数**: 实时显示已选择的回答数量
- **回答信息**: 表格显示答案 ID、赞同数、答主、回答摘要

---

## 导出格式示例

导出的 Markdown 包含:

### YAML Frontmatter

```yaml
---
title: 问题标题
source: https://www.zhihu.com/question/123456
date: 2024-01-01
answers: 3
tags: [知乎]
---
```

### 问题信息 Callout

```markdown
# 问题标题

> [!info] 问题信息
> - **问题ID:** 123456
> - **收藏时间:** 2024-01-01
> - **回答数量:** 3
> - **原文链接:** [查看原文](https://www.zhihu.com/question/123456)
```

### 回答分隔与信息

每个回答使用分隔线和标题区分:

```markdown
---

## 📝 用户名的回答

> [!quote]- 回答信息
> - **作者:** 用户名
> - **赞同:** 1234
> - **发布时间:** 2024-01-01
> - **答案ID:** 789012
> - **原文链接:** [查看原文](https://www.zhihu.com/question/123456/answer/789012)

> [!note]+ 回答内容
> 回答的具体内容...
> 支持多行文本
> 自动转换为 Markdown 格式
```

### 图片处理

- 图片自动下载并保存到 `{存储路径}/{图片文件夹}/{问题ID}/` 目录
- 使用 Obsidian 的 `![[图片路径]]` 语法引用
- 如果图片下载失败,会回退到使用原始 URL

---

## 内容转换规则

脚本会自动将知乎的 HTML 内容转换为 Markdown:

| HTML 元素 | Markdown 格式 |
|-----------|--------------|
| 图片 `<img>` | `![[图片路径]]` 或 `![alt](url)` |
| 链接 `<a>` | `[文本](链接)` |
| 标题 `<h1>-<h6>` | `#` 到 `######` |
| 粗体 `<b>/<strong>` | `**文本**` |
| 斜体 `<i>/<em>` | `*文本*` |
| 代码块 `<pre><code>` | ` ```代码``` ` |
| 行内代码 `<code>` | `` `代码` `` |
| 无序列表 `<ul><li>` | `- 项目` |
| 有序列表 `<ol><li>` | `1. 项目` |
| 段落 `<p>` | 文本 + 空行 |
| 换行 `<br>` | 换行符 |

---

## 追加模式

如果目标文件已存在,脚本会自动追加新的回答到文件末尾,而不是覆盖:

- ✅ 可以多次抓取同一问题的不同回答
- ✅ 可以持续补充高质量回答
- ✅ 已有内容不会丢失
- ⚠️ 不会自动去重,请注意避免重复抓取相同回答

---

## 常见问题

### Q: 连接测试失败?

1. 确认 Obsidian 已打开且 Local REST API 插件已启用
2. 检查 API Key 是否正确复制(不要有多余空格)
3. 确认端口号是否正确(默认 27123)
4. 检查防火墙是否阻止了本地连接

### Q: 图片无法显示?

1. 检查图片文件夹路径是否正确
2. 确认 Obsidian 有写入权限
3. 部分知乎图片可能有防盗链,导致下载失败
4. 查看浏览器控制台是否有错误信息

### Q: 抓取按钮点击后没反应?

1. 确保在知乎问题页面(URL 包含 `/question/`)
2. 等待页面完全加载后再点击
3. 检查浏览器控制台是否有 JavaScript 错误
4. 尝试刷新页面重试

### Q: 找不到回答列表?

1. 确保页面已滚动加载出回答内容
2. 知乎采用懒加载,需要向下滚动才能加载更多回答
3. 部分问题可能没有公开回答

### Q: 导出的 Markdown 格式不正确?

1. 知乎的富文本格式复杂,部分特殊格式可能转换不完美
2. 可以在 Obsidian 中手动调整格式
3. 建议在 GitHub 提交 issue 反馈具体问题

### Q: 如何更新脚本?

在油猴扩展中删除旧脚本,重新导入新版本即可。配置会保留。

---

## 使用技巧

### 1. 筛选高质量回答

在回答列表中,可以根据赞同数快速识别高质量回答:
- 赞同数显示在表格的第三列
- 可以只选择赞同数较高的回答导出

### 2. 组织知识库

建议的目录结构:
```
知乎收藏/
├── 技术类/
├── 生活类/
├── 学习类/
└── attachments/
    ├── 123456/  (问题ID)
    │   ├── image1.jpg
    │   └── image2.png
    └── 789012/
```

### 3. 配合 Obsidian 插件使用

推荐配合以下 Obsidian 插件使用:
- **Dataview**: 根据 frontmatter 查询和统计
- **Tag Wrangler**: 管理标签
- **Excalidraw**: 为笔记添加手绘图解

### 4. 定期备份

- 知乎内容可能被删除或修改
- 建议及时导出重要回答
- 定期备份 Obsidian vault

---

## 隐私说明

- 脚本仅在本地运行,不会上传任何数据到第三方服务器
- 所有内容直接保存到本地 Obsidian vault
- API Key 保存在浏览器本地存储中
- 图片通过 Obsidian Local REST API 保存到本地

---

## 版本信息

- **版本**: 1.0.0
- **作者**: ilvsx
- **适用站点**: 
  - https://www.zhihu.com/question/*
  - https://zhuanlan.zhihu.com/p/*
- **依赖**: Obsidian Local REST API 插件

---

## 反馈与贡献

如有问题或建议,欢迎通过以下方式反馈:
- 在 GitHub 仓库提交 Issue
- 提交 Pull Request 改进脚本

---

## 许可证

本脚本遵循 MIT 许可证开源。
